window.AFFWP=window.AFFWP||{},window.AFFWP.portal=window.AFFWP.portal||{},window.AFFWP.portal.directLink=function(t){var r={};function e(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}return e.m=t,e.c=r,e.d=function(t,r,n){e.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,r){if(1&r&&(t=e(t)),8&r)return t;if(4&r&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&r&&"string"!=typeof t)for(var i in t)e.d(n,i,function(r){return t[r]}.bind(null,i));return n},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},e.p="",e(e.s=36)}({0:function(t,r){t.exports=window.regeneratorRuntime},1:function(t,r){t.exports=window.wp.url},2:function(t,r){function e(t,r,e,n,i,o,a){try{var u=t[o](a),c=u.value}catch(t){return void e(t)}u.done?r(c):Promise.resolve(c).then(n,i)}t.exports=function(t){return function(){var r=this,n=arguments;return new Promise((function(i,o){var a=t.apply(r,n);function u(t){e(a,i,o,u,c,"next",t)}function c(t){e(a,i,o,u,c,"throw",t)}u(void 0)}))}},t.exports.__esModule=!0,t.exports.default=t.exports},3:function(t,r,e){"use strict";function n(t){return new Promise((function(r){return setTimeout(r,t)}))}function i(t){return"string"!=typeof t||t.endsWith("/")?t:"".concat(t,"/")}e.d(r,"a",(function(){return n})),e.d(r,"b",(function(){return i}))},36:function(t,r,e){"use strict";e.r(r);var n=e(2),i=e.n(n),o=e(0),a=e.n(o),u=e(8);r.default=function(){return{isLoading:!1,valid:!1,links:[],maxLinks:0,rejected:"",showingSuccessMessage:!1,showUpdateNotice:!1,showInvalidSubmission:!1,isDismissingNotice:!1,init:function(){var t=this;return i()(a.a.mark((function r(){var e;return a.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,AFFWP.portal.core.fetch({path:"affwp/v2/portal/integrations/direct-link-tracking/get-links",cacheResult:!1});case 2:e=r.sent,t.links=e.links.map((function(t){return t.timer=!1,t.isValidatingUrl=!1,t.isRemoving=!1,t})),t.rejected=e.rejected.join("<br>"),0===t.links.length&&t.addDomain(),t.checkValid(),t.isLoading=!1;case 8:case"end":return r.stop()}}),r)})))()},addDomain:function(){this.links.length+1<=this.maxLinks&&(this.links.push({url_id:"",url:"",errors:{}}),this.valid=!1)},getLinkObject:function(t){return void 0!==this.links[t]&&this.links[t]},getLinkParam:function(t,r){var e=this.getLinkObject(t);return!1===e||void 0===e[r]?"":e[r]},removeLink:function(t){var r=this;return i()(a.a.mark((function e(){var n,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.getLinkObject(t),!(i=n.url_id)){e.next=6;break}return n.isRemoving=!0,e.next=6,AFFWP.portal.core.fetch({path:"affwp/v2/portal/integrations/direct-link-tracking/links/".concat(i),method:"DELETE",data:{}});case 6:r.links.splice(t,1);case 7:case"end":return e.stop()}}),e)})))()},submit:function(){var t=this;return i()(a.a.mark((function r(){var e;return a.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.valid){r.next=2;break}return r.abrupt("return");case 2:return t.isLoading=!0,r.next=5,AFFWP.portal.core.fetch({path:"affwp/v2/portal/integrations/direct-link-tracking/save-links",method:"POST",data:{links:t.links}});case 5:e=r.sent,t.showInvalidSubmission=!e.success,t.links=e.links,t.rejected=e.rejected.join("<br>"),t.showUpdateNotice=!0,t.isLoading=!1;case 11:case"end":return r.stop()}}),r)})))()},dismiss:function(t){var r=this;return i()(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.isDismissingNotice){e.next=2;break}return e.abrupt("return");case 2:return r.isDismissingNotice=!0,r.isLoading=!0,e.next=6,AFFWP.portal.core.fetch({path:"affwp/v2/portal/integrations/direct-link-tracking/dismiss-notice",method:"POST",data:{url_id:t}});case 6:r.init();case 7:case"end":return e.stop()}}),e)})))()},hasError:function(t,r){return t.errors&&!0===t.errors[r]},hasErrors:function(t){return t.errors&&Object.keys(t.errors).length>0},checkValid:function(){var t=!0;this.links.find((function(t){return t.errors&&Object.keys(t.errors).length>0}))&&(t=!1),this.valid=t},validateFrontend:function(t){var r=this.getLinkObject(t);if(!1!==r){var e=r.url;clearTimeout(r.timer);var n=!1;if(r.errors=[],""===e.trim())r.errors.empty=!0,n=!0;else this.links.find((function(r,n){return n!==t&&r.url===e}))&&(r.errors.duplicated=!0,n=!0),Object(u.g)(e)||(r.errors.invalid=!0,n=!0);n?this.checkValid():(this.valid=!1,r.timer=setTimeout(this.validateBackend.bind(this,t),500))}},validateBackend:function(t){var r=this;return i()(a.a.mark((function e(){var n,i,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!1!==(n=r.getLinkObject(t))){e.next=3;break}return e.abrupt("return");case 3:return i=n.url,n.isValidatingUrl=!0,e.next=7,AFFWP.portal.core.fetch({path:"affwp/v2/portal/integrations/direct-link-tracking/validate",method:"POST",data:{url:i}});case 7:if(o=e.sent,n.isValidatingUrl=!1,i===n.url){e.next=11;break}return e.abrupt("return");case 11:o.success||(n.errors.addon=!0,n.errors.addonReason=o.error),r.checkValid();case 13:case"end":return e.stop()}}),e)})))()}}}},8:function(t,r,e){"use strict";e.d(r,"f",(function(){return l})),e.d(r,"c",(function(){return f})),e.d(r,"a",(function(){return a})),e.d(r,"b",(function(){return c})),e.d(r,"e",(function(){return s})),e.d(r,"g",(function(){return d})),e.d(r,"d",(function(){return p}));var n=e(1),i=e(3),o=/\/([^\/a-zA-Z-_]+)\/?$/;function a(t,r){return r.startsWith("/")&&(r=r.substr(1)),u(t,["protocol","authority","path",Object(i.b)(r),"querystring","fragment"])}function u(t,r){var e={getProtocol:function(){return"".concat(Object(n.getProtocol)(t),"//")},getAuthority:function(){return Object(i.b)(Object(n.getAuthority)(t))},getPath:function(){return Object(i.b)(Object(n.getPath)(t))},getQuerystring:function(){return Object(n.getQueryString)(t)?"?".concat(Object(n.getQueryString)(t)):""},getFragment:function(){return Object(n.getFragment)(t)}};return r.reduce((function(t,r){var n=["protocol","authority","path","querystring","fragment"].includes(r.toLowerCase());if(!n&&"string"==typeof r)return t+r;if(!n)return t;var i=(0,e["get"+r.charAt(0).toUpperCase()+r.slice(1).toLowerCase()])();return void 0===i?t:t+i}),"")}function c(t,r){var e=Object(n.getAuthority)(t);return e===r||new RegExp("\\w\\."+r+"$").test(e)}function s(t){var r=Object(n.getProtocol)(t);return["https:","http:"].includes(r)}function f(t){var r=Object(n.getPath)(t).match(o);return null===r?"1":r[1]}function l(t,r){f(t);var e=["protocol","authority",Object(i.b)(Object(n.getPath)(t)).replace(o,"/")];r.page&&(r.page>1&&e.push(r.page+"/"),delete r.page);var a=u(t,e);return Object(n.addQueryArgs)(a,r)}function d(t){return/\.\w\w.*/.test(t)}function p(t){var r=t.split("?"),e=r[1],n=r[0];return e?n+"?"+e.split("&").map((function(t){return t.split("=")})).sort((function(t,r){return t[0].localeCompare(r[0])})).map((function(t){return t.join("=")})).join("&"):n}}});