jQuery(document).ready((function(a){const e=parseInt(wpdiscuzAjaxObj.isNativeAjaxEnabled,10);if(a("body").on("click","#wpdcom .wmu-upload-wrap",(function(){a(".wpd-form-foot",a(this).parents(".wpd_comm_form")).slideDown(parseInt(wpdiscuzAjaxObj.enableDropAnimation)?500:0)})),a("body").on("change",".wmu-add-files",(function(){var t=a(this),d=t.parents(".wpd_comm_form"),o=t[0].files?t[0].files:[];o.length&&function(t,d,o){d.attr("data-uploading","true");var i=new FormData;i.append("action","wmuUploadFiles"),i.append("wmuAttachmentsData",a(".wmu-attachments-data",d).val()),i.append("uniqueId",d.find(".wpdiscuz_unique_id").val());var r=0;a.each(o,(function(a,e){r+=e.size,i.append(wpdiscuzAjaxObj.wmuInput+"["+a+"]",e)})),r>parseInt(wpdiscuzAjaxObj.wmuMaxFileSize)?wpdiscuzAjaxObj.setCommentMessage(wpdiscuzAjaxObj.applyFilterOnPhrase(wpdiscuzAjaxObj.wmuPhraseMaxFileSize,"wmuPhraseMaxFileSize",t),"error",3e3):r>parseInt(wpdiscuzAjaxObj.wmuPostMaxSize)?wpdiscuzAjaxObj.setCommentMessage(wpdiscuzAjaxObj.applyFilterOnPhrase(wpdiscuzAjaxObj.wmuPhrasePostMaxSize,"wmuPhrasePostMaxSize",t),"error",3e3):wpdiscuzAjaxObj.getAjaxObj(e,!0,i).done((function(e){e.success?(a(".wmu-attached-data-info",d).remove(),a(".wmu-add-files",d).after(e.data.attachmentsHtml),e.data.tooltip&&a(".wmu-upload-wrap",d).attr("wpd-tooltip",e.data.tooltip),function(e,t){a.each(t.data.previewsData,(function(t,d){a(".wmu-action-wrap .wmu-"+t+"-tab",e).html(""),a.each(d,(function(d,o){var i=o.id,r="",s=o.fullname,u=o.shortname;t==wpdiscuzAjaxObj.wmuKeyImages?(r=o.url,u=""):t==wpdiscuzAjaxObj.wmuKeyVideos?r=wpdiscuzAjaxObj.wmuIconVideo:t==wpdiscuzAjaxObj.wmuKeyFiles&&(r=wpdiscuzAjaxObj.wmuIconFile);var n='<div class="wmu-preview [PREVIEW_TYPE_CLASS]" title="[PREVIEW_TITLE]" data-wmu-type="[PREVIEW_TYPE]" data-wmu-attachment="[PREVIEW_ID]"><div class="wmu-preview-remove"><img class="wmu-preview-img" src="[PREVIEW_ICON]"><div class="wmu-file-name">[PREVIEW_FILENAME]</div><div class="wmu-delete">&nbsp;</div></div></div>';n=(n=(n=(n=(n=(n=n.replace("[PREVIEW_TYPE_CLASS]","wmu-preview-"+t)).replace("[PREVIEW_TITLE]",s)).replace("[PREVIEW_TYPE]",t)).replace("[PREVIEW_ID]",i)).replace("[PREVIEW_ICON]",r)).replace("[PREVIEW_FILENAME]",u),a(".wmu-action-wrap .wmu-"+t+"-tab",e).removeClass("wmu-hide").append(n)}))}))}(d,e),e.data.errors.length&&(wpdiscuzAjaxObj.setCommentMessage(e.data.errors,"error",3e3),console.log(e.data.errors))):e.data.errorCode?wpdiscuzAjaxObj.setCommentMessage(wpdiscuzAjaxObj.applyFilterOnPhrase(wpdiscuzAjaxObj[e.data.errorCode],e.data.errorCode,d),"error",3e3):e.data.error&&wpdiscuzAjaxObj.setCommentMessage(e.data.error,"error",3e3),a("#wpdiscuz-loading-bar").fadeOut(250),d.attr("data-uploading","false")})).fail((function(e,t,o){console.log(o),a("#wpdiscuz-loading-bar").fadeOut(250),d.attr("data-uploading","false")}))}(t,d,o)})),a("body").on("click",".wmu-attachment-delete",(function(t){if(confirm(wpdiscuzAjaxObj.wmuPhraseConfirmDelete)){var d=a(this),o=d.data("wmu-attachment"),i=new FormData;i.append("action","wmuDeleteAttachment"),i.append("attachmentId",o),wpdiscuzAjaxObj.getAjaxObj(e,!0,i).done((function(e){if(e.success){var t=d.parents(".wmu-comment-attachments");d.parent(".wmu-attachment").remove(),a(".wmu-attached-images *",t).length||a(".wmu-attached-images",t).remove(),a(".wmu-attached-videos *",t).length||a(".wmu-attached-videos",t).remove(),a(".wmu-attached-files *",t).length||a(".wmu-attached-files",t).remove()}else e.data.errorCode?wpdiscuzAjaxObj.setCommentMessage(wpdiscuzAjaxObj.applyFilterOnPhrase(wpdiscuzAjaxObj[e.data.errorCode],e.data.errorCode,t),"error",3e3):e.data.error&&wpdiscuzAjaxObj.setCommentMessage(e.data.error,"error",3e3);a("#wpdiscuz-loading-bar").fadeOut(250)})).fail((function(e,t,d){console.log(d),a("#wpdiscuz-loading-bar").fadeOut(250)}))}else console.log("canceled")})),a("body").on("click",".wmu-preview",(function(){var t=a(this),d=t.parents(".wpd_comm_form"),o=(t.data("wmu-type"),t.data("wmu-attachment")),i=new FormData;i.append("action","wmuRemoveAttachmentPreview"),i.append("attachmentId",o),i.append("wmuAttachmentsData",a(".wmu-attachments-data",d).val()),i.append("uniqueId",d.find(".wpdiscuz_unique_id").val()),wpdiscuzAjaxObj.getAjaxObj(e,!0,i).done((function(e){if(e.success){t.remove();var o=a(".wmu-tabs",d);a.each(o,(function(e,t){a(".wmu-preview",t).length?a(t).removeClass("wmu-hide"):a(t).addClass("wmu-hide")})),a(".wmu-attached-data-info",d).remove(),a(".wmu-add-files",d).after(e.data.attachmentsHtml),e.data.tooltip&&a(".wmu-upload-wrap",d).attr("wpd-tooltip",e.data.tooltip)}else e.data.errorCode?wpdiscuzAjaxObj.setCommentMessage(wpdiscuzAjaxObj.applyFilterOnPhrase(wpdiscuzAjaxObj[e.data.errorCode],e.data.errorCode,d),"error",3e3):e.data.error&&wpdiscuzAjaxObj.setCommentMessage(e.data.error,"error",3e3);a("#wpdiscuz-loading-bar").fadeOut(250)})).fail((function(e,t,d){console.log(d),a("#wpdiscuz-loading-bar").fadeOut(250)}))})),parseInt(wpdiscuzAjaxObj.wmuIsLightbox)){function t(){a(".wmu-lightbox").colorbox({maxHeight:"95%",maxWidth:"95%",rel:"wmu-lightbox",fixed:!0})}t(),wpdiscuzAjaxObj.wmuAddLightBox=t}wpdiscuzAjaxObj.wmuHideAll=function(e,t){"object"==typeof e?e.success?(a(".wmu-tabs",t).addClass("wmu-hide"),a(".wmu-preview",t).remove(),a(".wmu-attached-data-info",t).remove()):console.log(e.data):console.log(e)}}));