"use strict";(function(document,window,$){var el={},app={init:function(){$(app.ready)},ready:function(){app.initVars(),app.events()},initVars:function(){el={$stepAddYourself:$("section.step-add-yourself"),$stepAddYourselfNum:$("section.step-add-yourself .num img"),$stepPortalAddon:$("section.step-portal-addon"),$stepPortalAddonNum:$("section.step-portal-addon .num img")}},events:function(){el.$stepAddYourself.on("click","button",app.stepAddYourselfClick),el.$stepPortalAddon.on("click","button",app.stepPortalAddonClick)},stepAddYourselfClick:function(){var $btn=$(this),$error=$(this).next("p"),btnTextOrigin=$btn.text(),ajaxAction="affwp_add_yourself_step";$btn.hasClass("disabled")||($error.length>0&&$error.remove(),$btn.text(affiliatewpSetupScreen.adding).addClass("disabled"),app.showSpinner(el.$stepAddYourselfNum),$.post(affiliatewpSetupScreen.ajax_url,{action:ajaxAction,nonce:affiliatewpSetupScreen.nonce}).done(function(res){return res.success?($btn.text(affiliatewpSetupScreen.add_affiliate_step_complete).addClass("grey").removeClass("button-primary"),el.$stepAddYourselfNum.attr("src",el.$stepAddYourselfNum.attr("src").replace("step-2.","step-complete.")),void location.reload()):void $btn.text(btnTextOrigin).removeClass("disabled").parent().after('<p class="error">'+affiliatewpSetupScreen.setup_screen_error+"</p>")}).always(function(){app.hideSpinner(el.$stepAddYourselfNum)}))},stepPortalAddonClick:function(){var $btn=$(this),action=$btn.attr("data-action"),plugin=$btn.attr("data-plugin"),btnTextOrigin=$btn.text(),ajaxAction="";if(!$btn.hasClass("disabled")){switch(action){case"activate":ajaxAction="affwp_activate_plugin",$btn.text(affiliatewpSetupScreen.activating);break;case"install":ajaxAction="affwp_install_plugin",$btn.text(affiliatewpSetupScreen.installing);break;case"goto-url":return void(window.location.href=$btn.attr("data-url"));default:return}$btn.addClass("disabled"),app.showSpinner(el.$stepPortalAddonNum),$.post(affiliatewpSetupScreen.ajax_url,{action:ajaxAction,nonce:affiliatewpSetupScreen.nonce,plugin:plugin}).done(function(res){app.stepPortalAddonDone(res,$btn,action)}).fail(function(){$btn.removeClass("disabled").text(btnTextOrigin)}).always(function(){app.hideSpinner(el.$stepPortalAddonNum)})}},stepPortalAddonDone:function(res,$btn,action){if("install"===action?res.success&&res.data.is_activated:res.success)return $btn.text(affiliatewpSetupScreen.portal_step_complete).addClass("grey").removeClass("button-primary"),void el.$stepPortalAddonNum.attr("src",el.$stepPortalAddonNum.attr("src").replace("step-3.","step-complete."));var activationFail="install"===action&&res.success&&!res.data.is_activated||"activate"===action,url=activationFail?affiliatewpSetupScreen.manual_activate_url:affiliatewpSetupScreen.manual_install_url,msg=activationFail?affiliatewpSetupScreen.error_could_not_activate:affiliatewpSetupScreen.error_could_not_install,btn=activationFail?affiliatewpSetupScreen.plugins_page:affiliatewpSetupScreen.download_now;$btn.removeClass("disabled").text(btn).attr("data-action","goto-url").attr("data-url",url).after('<p class="error">'+msg+"</p>")},showSpinner:function($el){$el.siblings(".loader").removeClass("hidden")},hideSpinner:function($el){$el.siblings(".loader").addClass("hidden")}};return app})(document,window,jQuery).init();