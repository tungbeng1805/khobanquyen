"use strict";function _typeof(o){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o})(o)}jQuery(document).ready(function($){function maybe_activate_migrate_users_button(){var checked=$("#affiliate-wp-migrate-user-accounts input:checkbox:checked").length,$button=$("#affiliate-wp-migrate-user-accounts input[type=submit]");checked>0?$button.prop("disabled",!1):$button.prop("disabled",!0)}var file_frame;window.formfield="";var affwpSelect2Width="175px";$("body").on("click",".affwp_settings_upload_button",function(e){e.preventDefault();var button=$(this);return window.formfield=$(this).prev(),file_frame?void file_frame.open():(file_frame=wp.media.frames.file_frame=wp.media({frame:"post",state:"insert",title:button.data("uploader_title"),button:{text:button.data("uploader_button_text")},multiple:!1}),file_frame.on("menu:render:default",function(view){var views={};view.unset("library-separator"),view.unset("gallery"),view.unset("featured-image"),view.unset("embed"),view.set(views)}),file_frame.on("insert",function(){var selection=file_frame.state().get("selection");selection.each(function(attachment,index){attachment=attachment.toJSON(),window.formfield.val(attachment.url);var event=new CustomEvent("mediaURLChanged",{detail:{url:attachment.url}});document.dispatchEvent(event)})}),void file_frame.open())});var file_frame;window.formfield="",$(".affwp-referrals-export-toggle").click(function(){$(".affwp-referrals-export-toggle").toggle(),$("#affwp-referrals-export-form").slideToggle()}),$(".affwp-datepicker").length&&$(".affwp-datepicker").datepicker({dateFormat:"mm/dd/yy"}),$(".affwp-user-search").each(function(){var $all_input_fields,$all_fields_excluding_search,$this=$(this),$action="affwp_search_users",$search=$this.val(),$status=$this.data("affwp-status"),$form=$this.closest("form"),$submit=$form.find(":submit.button-primary"),$submit_default_value=$submit.val(),$user_creation_fields=$(".affwp-user-email-wrap, .affwp-user-pass-wrap"),$on_complete_enabled=$this.hasClass("affwp-enable-on-complete");$on_complete_enabled===!0&&($all_input_fields=$form.find("input, select"),$all_fields_excluding_search=$all_input_fields.not($this)),$this.on("input",function(){$user_creation_fields.hide()}),$this.autocomplete({source:ajaxurl+"?action="+$action+"&term="+$search+"&status="+$status,messages:{noResults:$on_complete_enabled?"":"No users found"},delay:500,minLength:2,position:{offset:"0, -1"},search:function(){$this.hasClass("affwp-enable-on-complete")&&($("div.notice").remove(),$user_creation_fields.hide())},open:function(){$this.addClass("open")},close:function(){$this.removeClass("open")},response:function(event,ui){0===ui.content.length&&$this.hasClass("affwp-enable-on-complete")?($('<div class="notice notice-error affwp-new-affiliate-error"><p>'+affwp_vars.no_user_found+"</p></div>").insertAfter($this),wp.a11y.speak(affwp_vars.no_user_found,"polite"),$form.find("input, select").prop("disabled",!1),$(".affwp-user-email-wrap, .affwp-user-pass-wrap").show(),$(".affwp-user-email").prop("required"),$(".search-description").hide(),$submit.val(affwp_vars.user_and_affiliate_input)):wp.a11y.speak(affwp_vars.valid_user_selected,"polite")},select:function(){$this.hasClass("affwp-enable-on-complete")&&$.ajax({type:"POST",url:ajaxurl,data:{action:"affwp_check_user_login",user:$this.val()},dataType:"json",success:function(response){if(response.success)if(!1===response.data.affiliate)$form.find("input, select").prop("disabled",!1);else{var viewLink='<a href="'+response.data.url+'">'+affwp_vars.view_affiliate+"</a>";$('<div class="notice notice-info affwp-new-affiliate-error"><p>'+affwp_vars.existing_affiliate+" "+viewLink+"</p></div>").insertAfter($this),$this.prop("disabled",!1)}}}).fail(function(response){window.console&&window.console.log&&console.log(response)})}}),$on_complete_enabled===!0&&$this.on("input",function(){$all_fields_excluding_search.prop("disabled",!0),$submit.val($submit_default_value)})});var file_frame;if($("body").on("click",".upload_image_button",function(e){e.preventDefault();var formfield=$(this).prev();return file_frame?void file_frame.open():(file_frame=wp.media.frames.file_frame=wp.media({frame:"select",title:"Choose Image",multiple:!1,library:{type:"image"},button:{text:"Use Image"}}),file_frame.on("menu:render:default",function(view){var views={};view.unset("library-separator"),view.unset("gallery"),view.unset("featured-image"),view.unset("embed"),view.set(views)}),file_frame.on("select",function(){var attachment=file_frame.state().get("selection").first().toJSON();formfield.val(attachment.url);var img=$("<img />");img.attr("src",attachment.url),$("#preview_image").empty().append(img),$("#preview_image img")&&$("#preview_image").show()}),void file_frame.open())}),$("body").on("click",".affiliates_page_affiliate-wp-referrals .delete",function(e){return!!confirm(affwp_vars.confirm_delete_referral)}),maybe_activate_migrate_users_button(),$("body").on("change","#affiliate-wp-migrate-user-accounts input:checkbox",function(){maybe_activate_migrate_users_button()}),$("#affwp_add_affiliate #status").change(function(){var status=$(this).val();"active"==status?$("#affwp-welcome-email-row").show():($("#affwp-welcome-email-row").hide(),$("#affwp-welcome-email-row #welcome_email").prop("checked",!1))}),$("#generate-coupon-code-button").on("click",function(event){event.preventDefault(),$.ajax({type:"POST",url:ajaxurl,data:{action:"affwp_generate_coupon_code",affiliate_id:$(this).data("affiliate_id")},dataType:"json",success:function(response){response.success&&response.data.coupon_code&&$("#coupon_code").val(response.data.coupon_code)}})}),"?page=affiliate-wp-settings&tab=coupons"===window.location.search){for(var getCustomText=function(){var customText=document.getElementById("affwp_settings[coupon_custom_text]").value;return""===customText?"TEXT":customText.replace(/[^0-9a-z]/gi,"")},returnLivePreviewText=function(text){var previewText=text;previewText=previewText.replace("{coupon_code}","FGFUVCQOK1"),previewText=previewText.replace("{user_name}","CREATIVELABS"),previewText=previewText.replace("{first_name}","BOB"),previewText=previewText.replace("{coupon_amount}","10"),previewText=previewText.replace("{custom_text}",getCustomText()),previewText=previewText.toUpperCase();var keepHyphens=checkHyphenDelimiterSetting();return!0===keepHyphens?previewText:previewText.replace(/-/g,"")},updateCouponFormatOptions=function(){var hyphenSettingChecked=checkHyphenDelimiterSetting(),formatOptions=document.getElementById("affwp_settings[coupon_format]").options;if(!0===hyphenSettingChecked)for(var index=0;index<formatOptions.length;index++)formatOptions[index].text=returnLivePreviewText(couponFormatOptions[index]);else for(var index=0;index<formatOptions.length;index++)formatOptions[index].text=formatOptions[index].text.replace(/-/g,"")},checkHyphenDelimiterSetting=function(){return $("input[id='affwp_settings[coupon_hyphen_delimiter]']").is(":checked")},resetCFSelectedOption=function(){var formatValue=$("select[id='affwp_settings[coupon_format]'] option:selected")[0].value;!1===checkHyphenDelimiterSetting()&&(formatValue=formatValue.replace(/-/g,"")),$("select[id='affwp_settings[coupon_format]'] option:selected")[0].text=formatValue},formatOptions=document.getElementById("affwp_settings[coupon_format]").options,couponFormatOptions=[],option=0;option<formatOptions.length;option++)couponFormatOptions.push(formatOptions[option].text),formatOptions[option].text=returnLivePreviewText(couponFormatOptions[option]);resetCFSelectedOption(),$("select[id='affwp_settings[coupon_format]']").on("change",function(event){updateCouponFormatOptions(),resetCFSelectedOption()}),$("input[id='affwp_settings[coupon_hyphen_delimiter]']").on("click",function(event){updateCouponFormatOptions(),resetCFSelectedOption()}),$("input[id='affwp_settings[coupon_custom_text]']").on("keyup",function(){for(var i=0;i<formatOptions.length;i++)formatOptions[i].text=returnLivePreviewText(couponFormatOptions[i])})}$(".affwp-promo-notice").each(function(){var notice=$(this),noticeId=notice.data("id"),nonce=notice.data("nonce"),lifespan=notice.data("lifespan");notice.on("click",".notice-dismiss, .affwp-notice-dismiss",function(event){wp.ajax.send("affwp_dismiss_promo",{data:{notice_id:noticeId,nonce:nonce,lifespan:lifespan},success:function(){notice.slideUp("fast");var uid=userSettings.uid?userSettings.uid:0,seenKey="affwp-notice-"+noticeId+"-seen-"+uid;window.localStorage.removeItem(seenKey)}})})});var topOfPageNotice=jQuery(".affwp-admin-notice-top-of-page");if(topOfPageNotice.length>0){var topOfPageNoticeEl=topOfPageNotice.detach();jQuery("#wpbody-content").prepend(topOfPageNoticeEl);var uid=userSettings.uid?userSettings.uid:0,noticeId=topOfPageNoticeEl.data("id"),seenKey="affwp-notice-"+noticeId+"-seen-"+uid;window.localStorage.getItem(seenKey)?topOfPageNoticeEl.show():setTimeout(function(){window.localStorage.setItem(seenKey,!0),topOfPageNotice.slideDown()},1500)}if($.inArray(pagenow,["affiliates_page_affiliate-wp-affiliates","affiliates_page_affiliate-wp-settings"])>-1){var flatRateBasisField,referralRateTypeField;"affiliates_page_affiliate-wp-settings"===pagenow?(flatRateBasisField=$(".affwp-referral-rate-type-field"),referralRateTypeField=$('input[name="affwp_settings[referral_rate_type]"]')):(flatRateBasisField=$("#flat_rate_basis").closest("tr"),referralRateTypeField=$("#rate_type")),referralRateTypeField.on("change",function(e){"flat"!==e.target.value?flatRateBasisField.hide():flatRateBasisField.show()})}if($.inArray(pagenow,["affiliates_page_affiliate-wp-settings"])>-1){var affwpShouldFieldBeVisible=function(fieldVal,expectedVal,compare){return!(!["==","==="].includes(compare)||fieldVal!=expectedVal)||!(!["!=","<>"].includes(compare)||fieldVal==expectedVal)},affwpIsVisible=function($field,expectedValue,comparison){var tag=$field.get(0).tagName;return"INPUT"===tag&&"radio"===$field.attr("type")?affwpShouldFieldBeVisible($field.filter(":checked").val(),expectedValue,comparison):"INPUT"===tag&&"checkbox"===$field.attr("type")?affwpShouldFieldBeVisible($field.is(":checked"),expectedValue,comparison):"SELECT"===tag?affwpShouldFieldBeVisible($field.val(),expectedValue,comparison):void 0};$(".affwp-accordion").each(function(){var $accordion=$(this);$accordion.find("> .affwp-accordion-item > .affwp-accordion-title").on("click",function(e){e.stopPropagation();var $accordionItem=$(this).parent();void 0!==$accordion.data("toggle")&&$accordionItem.siblings().not($accordionItem.get(0)).addClass("affwp-accordion-collapsed"),$accordionItem.toggleClass("affwp-accordion-collapsed")})}),$("tr[data-visibility]").each(function(){var $row=$(this),$form=$("#affwp-settings-form"),ruleset=$row.data("visibility"),$field=$form.find('input[name="affwp_settings['.concat(ruleset.rule.required_field,']"]')),comparison=ruleset.rule.hasOwnProperty("compare")?ruleset.rule.compare:"==";$field.on("change",function(){return affwpIsVisible($field,ruleset.rule.value,comparison)?void $row.show():void $row.hide()})}),$(".affwp-section[data-visibility]").each(function(){var $section=$(this),$form=$("#affwp-settings-form"),ruleset=$section.data("visibility"),$field=$form.find('input[name="affwp_settings['.concat(ruleset.required_field,']"]')),comparison=ruleset.hasOwnProperty("compare")?ruleset.compare:"==";$field.on("change",function(){return affwpIsVisible($field,ruleset.value,comparison)?void $section.show():void $section.hide()})}),$("#affwp-settings-form select").each(function(){var $select=$(this),$row=$select.closest("tr");["portal_menu_links","affiliate_area_tabs_list"].includes($row.attr("id"))||$row.hasClass("affwp-ignore-select2")||($row.addClass("affwp-select2-initialized"),$select.select2({width:"240px",minimumResultsForSearch:-1,templateResult:function(option){return option.id&&option.element.classList.contains("addProBadge")?$("<span>".concat(option.text,'</span><span class="affwp-settings-label-pro">PRO</span>')):option.text},templateSelection:function(option){return option.id&&option.element.classList.contains("addProBadge")?$("<span>".concat(option.text,'</span><span class="affwp-settings-label-pro">PRO</span>')):option.text}}).on("change",function(e){$(document).trigger("affiliatewp_on_select_change",[e])}))}),$(".affwp-select2-initialized label").on("click",function(){$(this).closest("tr").find("select").select2("open")})}if("undefined"!=typeof postboxes&&/affiliate-wp/.test(pagenow)&&postboxes.add_postbox_toggles(pagenow),$.inArray(pagenow,["affiliates_page_affiliate-wp-about"])>-1&&$(".affwp-action-button").on("click",function(){var $button=$(this);if(!$button.hasClass("disabled")){if($button.hasClass("status-go-to-url"))return void window.open($button.data("plugin"),"_blank");var buttonOriginalText=$button.text(),buttonOriginalClasses=$button.attr("class"),action=$button.hasClass("status-missing")?"affwp_install_plugin":"affwp_activate_plugin",$actionContainer=$button.closest(".affwp-addon-action"),showNotice=function($container,status,content){$container.addClass("affwp-addon-action--"+status).attr("data-content",content).delay(2500).queue(function(){$(this).removeAttr("data-content").removeClass("affwp-addon-action--"+status)})};$.ajax({type:"POST",url:ajaxurl,data:{action:action,nonce:affwp_about_vars.nonce,plugin:$button.data("plugin")},dataType:"json",beforeSend:function(){$button.text("").removeAttr("class").addClass("affwp-action-button button button-secondary disabled loading")},success:function(response){return response.success?($button.text(affwp_about_vars.i18n.activated),$actionContainer.find(".status-label").removeClass("status-inactive").addClass("status-active").text(affwp_about_vars.i18n.active),void showNotice($actionContainer,"ok","affwp_activate_plugin"===action?affwp_about_vars.i18n.pluginActivated:affwp_about_vars.i18n.pluginInstalledAndActivated)):($button.text(buttonOriginalText).removeAttr("class").addClass(buttonOriginalClasses),void showNotice($actionContainer,"error",response.data))},complete:function(){$button.removeClass("loading")}}).fail(function(response){$button.text(buttonOriginalText).removeAttr("class").addClass(buttonOriginalClasses),showNotice($actionContainer,"error",affwp_about_vars.i18n.genericError)})}}),$.inArray(pagenow,["affiliates_page_affiliate-wp-creatives"])>-1){if("undefined"!=typeof affiliatewp&&affiliatewp.has("qrcode")){$("#the-list .column-preview").each(function(){var $qrCode=$(this).find(".affwp-qrcode-preview");affiliatewp.qrcode($qrCode.get(0),$qrCode.data("url"),affiliatewp.parseArgs("object"===_typeof($qrCode.data("settings"))?$qrCode.data("settings"):{},{width:80,height:80,margin:3,errorCorrectionLevel:"H"}))});var qrPreviewEl=document.getElementById("qr-preview");if(qrPreviewEl){var qrSettings=affiliatewp.parseArgs(qrPreviewEl.dataset.settings?JSON.parse(qrPreviewEl.dataset.settings):{color:{dark:"#444444",light:"#FFFFFF"}},{width:200,height:200,margin:3});affiliatewp.qrcode(qrPreviewEl,affwpCreativeUrls.creativeUrl,qrSettings);var inputHandler,getColorSettings=function(){return{dark:$("#qrcode-code-color").val(),light:$("#qrcode-bg-color").val()}},updateColors=function(){var color=getColorSettings(),existingQR=qrPreviewEl.firstChild;existingQR&&($(existingQR).find("path:eq(0)").css("fill",color.light),$(existingQR).find("path:eq(1)").css("stroke",color.dark))};$(".form-table #qrcode-url").on("input",function(){var newUrl=$(this).val(),color=getColorSettings();clearTimeout(inputHandler),inputHandler=setTimeout(function(){qrPreviewEl.removeChild(qrPreviewEl.firstChild),affiliatewp.qrcode(qrPreviewEl,""===newUrl?affwpCreativeUrls.siteUrl:newUrl,affiliatewp.parseArgs({color:color},qrSettings)),$(qrPreviewEl).addClass("qr-code-updated"),setTimeout(function(){$(qrPreviewEl).removeClass("qr-code-updated")},200)},1e3)}),$(".affwp-color-picker").wpColorPicker({clear:function(){updateColors()},change:function(event,ui){$(this).val(ui.color.toString()),updateColors(),$(".qrcode-disclaimer").fadeIn()}}),$(".wp-picker-clear").on("click",function(){var $self=$(this),color=$self.closest(".qrcode-color-picker-container").data("default-color");$self.closest(".qrcode-color-picker-container").find("input.affwp-color-picker").val(color).trigger("change")})}}$("#affwp_add_creative, #affwp_edit_creative").on("submit",function(e){var $name=$("#name");return"yes"!==$name.data("private")||!(affwp_vars.creativeDefaultName===$name.val()&&!confirm(affwp_vars.creativeUpdateNameConfirm))});var contexts={text_link:{text:""},image:{text:""},qr_code:{text:""}},prevType=$("#type").val();$(".form-table #type").select2({width:affwpSelect2Width,minimumResultsForSearch:-1,templateResult:function(option){return option.id&&"qr_code"===option.id&&option.element.classList.contains("addProBadge")?$("<span>".concat(option.text,'</span><span class="affwp-settings-label-pro">PRO</span>')):option.text},templateSelection:function(option){return option.id&&"qr_code"===option.id&&option.element.classList.contains("addProBadge")?$("<span>".concat(option.text,'</span><span class="affwp-settings-label-pro">PRO</span>')):option.text}}).on("change",function(e){var $text=$("#text"),$type=$("#type"),$image=$("#image"),$url=$("#url"),$qrCodeUrl=$("#qrcode-url");return $text.attr("required",!1),$image.attr("required",!1),$url.attr("disabled",!1),$qrCodeUrl.attr("disabled",!0),$qrCodeUrl.closest(".affwp-education-modal-input-wrapper").find("span").removeClass("affwp-education-modal"),contexts[prevType].text=$text.val(),prevType=$type.val(),$text.val(contexts[$type.val()].text),$(".form-table").attr("data-current-context",$(this).val()),"image"===$type.val()?void $image.attr("required",!0):("text_link"===$type.val()&&$text.attr("required",!0),"qr_code"===$type.val()&&$type.find("option:selected").hasClass("affwp-education-notice")?($url.attr("disabled",!0),void $qrCodeUrl.closest(".affwp-education-modal-input-wrapper").find("span").addClass("affwp-education-modal")):void("qr_code"===$type.val()&&($url.attr("disabled",!0),$qrCodeUrl.attr("disabled",!1))))}),$("#type").on("select2:selecting",function(e){if($(e.target).hasClass("select2-hidden-accessible")){var selectedOptionClass=e.params.args.data.element.className;selectedOptionClass&&selectedOptionClass.includes("affwp-education-modal")&&e.preventDefault()}}),$('label[for="type"]').click(function(){$("#type").select2("open")}),$("select#status").select2({width:affwpSelect2Width,minimumResultsForSearch:-1,templateResult:function(option){return option.id&&"scheduled"===option.id&&$(".addProBadge").length>0?$("<span>".concat(option.text,'</span><span class="affwp-settings-label-pro">PRO</span>')):option.text},templateSelection:function(option){return option.id&&"scheduled"===option.id&&$(".addProBadge").length>0?$("<span>".concat(option.text,'</span><span class="affwp-settings-label-pro">PRO</span>')):option.text}}).on("change",function(e){return $(".affwp-schedule-creatives-setting").length>0&&"scheduled"===$("#status").val()?void $(".affwp-schedule-creatives-setting").removeClass("affwp-hidden"):void($("#affwp_edit_creative").length>0||$(".affwp-schedule-creatives-setting").addClass("affwp-hidden"))}),$('label[for="status"]').click(function(){$("#status").select2("open")}),$(".affwp-schedule-creative-datepicker").length&&$(".affwp-schedule-creative-datepicker").datepicker({dateFormat:"mm/dd/yy",defaultDate:"",showButtonPanel:!0,onSelect:function(date){var option=$(this).is('.affwp-schedule-creative-datepicker[name="start_date"]')?"minDate":"maxDate",dates=$(this).closest(".schedule-creative-date-fields").find("input");"minDate"===option?date=new Date($(this).datepicker("getDate").getTime()+864e5):"maxDate"===option&&(date=new Date($(this).datepicker("getDate").getTime()-864e5)),dates.not(this).datepicker("option",option,date),$(this).trigger("change")}})}$('.affwp-batch-form[data-batch_id="update-creative-names"] input[type="radio"]').on("change",function(){var $option=$(this);$("#v2160-update-creative-names").val("private"===$option.val()?affwp_vars.creativeUpgradeNoticeNo:affwp_vars.creativeUpgradeNoticeYes).removeClass("button-disabled").attr("disabled",!1)})});