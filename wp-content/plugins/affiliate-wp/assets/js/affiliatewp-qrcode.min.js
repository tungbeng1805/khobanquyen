"use strict";function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function _defineProperty(obj,key,value){return key=_toPropertyKey(key),key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _toPropertyKey(arg){var key=_toPrimitive(arg,"string");return"symbol"===_typeof(key)?key:String(key)}function _toPrimitive(input,hint){if("object"!==_typeof(input)||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0!==prim){var res=prim.call(input,hint||"default");if("object"!==_typeof(res))return res;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===hint?String:Number)(input)}function _typeof(o){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o})(o)}affiliatewp.attach("qrcode",function(element,text){var settings=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},qrCodeGenerator={element:null,text:"",code:"",settings:{width:256,height:256,quality:.92,format:"svg",margin:2,color:{dark:"#000000",light:"#FFFFFF"},errorCorrectionLevel:"M",on:{load:function(){},error:function(){}}},cacheSettings:{enable:!0,key:"affwp_qrcodes",sizeLimit:5242880},setCacheSettings:function(){var settings=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.cacheSettings=affiliatewp.parseArgs(settings,this.cacheSettings)},getCache:function(){var _JSON$parse;return null!==(_JSON$parse=JSON.parse(localStorage.getItem(this.cacheSettings.key)))&&void 0!==_JSON$parse?_JSON$parse:[]},clearCache:function(){localStorage.removeItem(this.cacheSettings.key)},saveCache:function(cache){localStorage.setItem(this.cacheSettings.key,JSON.stringify(cache))},getCacheSize:function(cache){if("function"==typeof TextEncoder){var encoder=new TextEncoder;return encoder.encode(JSON.stringify(cache)).length}return 2*JSON.stringify(cache).length},enforceCacheSizeLimit:function(cache){for(var cacheSize=this.getCacheSize(cache);cacheSize>this.cacheSettings.sizeLimit&&0!==cache.length;)cache.shift(),cacheSize=this.getCacheSize(cache)},setCacheItem:function(key,value){if(!this.getCacheItemByKey(key)){var cache=this.getCache();cache.push({key:key,value:value}),this.enforceCacheSizeLimit(cache),this.saveCache(cache)}},removeCacheItemByKey:function(key){var cache=this.getCache(),index=cache.findIndex(function(item){return item.key===key});index!==-1&&(cache.splice(index,1),this.saveCache(cache))},getCacheItemByKey:function(key){var cache=this.getCache();return cache.find(function(item){return item.key===key})||null},updateSettings:function(settings){if(settings.hasOwnProperty("width")&&!Number.isInteger(settings.width))throw new Error("Width must be an integer, got ".concat(_typeof(settings.width)));if(settings.hasOwnProperty("height")&&!Number.isInteger(settings.height))throw new Error("Height must be an integer, got ".concat(_typeof(settings.height)));if(settings.hasOwnProperty("format")&&!["svg","png"].includes(settings.format))throw new Error("Expected svg or png formats, got ".concat(settings.format));this.settings=affiliatewp.parseArgs(settings,this.settings)},getCacheItemKey:function(text){var data=_objectSpread({},this.settings);return delete data.on,data.text=text,affiliatewp.crypto(data).md5()},createQRCode:function(text,type,callback){if("string"!=typeof text)throw new Error("Expected text, got ".concat(text,"."));var cacheItem=this.cacheSettings.enable?this.getCacheItemByKey(this.getCacheItemKey(text)):null;if(cacheItem&&"function"==typeof callback)return void callback(cacheItem.value);var qrCodeLibSettings=_objectSpread({},this.settings);delete qrCodeLibSettings.format,delete qrCodeLibSettings.on;var options=_objectSpread(_objectSpread({},qrCodeLibSettings),{type:type}),qrCodeFunction="svg"===type?QRCode.toString:QRCode.toDataURL;qrCodeFunction(text,options,function(err,result){if(err)throw err;"function"==typeof callback&&callback(result)})},createSVG:function(text,callback){this.createQRCode.call(this,text,"svg",callback)},createPNG:function(text,callback){this.createQRCode.call(this,text,"image/png",callback)},generate:function(element,text){var _this=this,settings=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!(element instanceof Element))throw new Error("Expected Element, got ".concat(_typeof(element)));this.element=element,this.text=text,this.updateSettings(settings);var onComplete=function(text,output){_this.code=output,_this.setCacheItem(_this.getCacheItemKey(text),output),"function"==typeof _this.settings.on.load&&_this.settings.on.load(_this),_this.element.classList.add("affwp-qrcode-initialized")};try{if("svg"===this.settings.format)return void this.createSVG(text,function(output){_this.element.insertAdjacentHTML("afterbegin",output),onComplete(text,output)});this.createPNG(text,function(output){var img=document.createElement("img");img.width=_this.settings.width,img.height=_this.settings.height,img.alt="QR Code",img.src=output,_this.element.insertAdjacentElement("afterbegin",img),onComplete(text,output)})}catch(err){console.error(err),this.settings.on.error(err)}}};return element&&text&&qrCodeGenerator.generate(element,text,settings?settings:{}),qrCodeGenerator});