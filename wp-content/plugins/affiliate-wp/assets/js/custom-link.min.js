"use strict";function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}window.affWPCustomLink=window.affWPCustomLink||function($){var vars=affWpCustomLinksVars,el={},app={customLink:{},notices:null,noticesTimeout:3e3,init:function(){$(app.ready)},ready:function(){el={$url:$("#affwp-url"),$campaign:$("#affwp-campaign"),$campaignBtn:$("#affwp-generator-toggle-campaign"),$form:$("#affwp-custom-link-generator"),$table:$("#affwp-custom-links-table"),$notices:$("#affwp-generator-submit-notices"),$submitBtn:$("#affwp-generator-submit-btn")},app.events()},events:function(){el.$form.on("submit",app.onSave),el.$table.on("click",".affwp-custom-link",app.onCopy),el.$table.on("click",".affwp-edit-custom-link",app.onEdit),el.$campaign.on("focusout",app.cleanCampaignWhitespaces),el.$campaignBtn.on("click",app.onClickCampaignBtn),app.initializeSubmissionNotices(),app.updateTooltips()},initializeSubmissionNotices:function(){app.notices=tippy(el.$notices.get(0),{content:"",trigger:"manual",placement:"top",animation:"fade",hideOnClick:!1})},updateTooltips:function(){app.initializeButtons(".affwp-tooltip-url-copy:not(.affwp-tooltip-initialized)","click",vars.i18n.copied,1e3),app.initializeButtons(".affwp-tooltip-button-copy:not(.affwp-tooltip-initialized)","mouseenter focus",vars.i18n.copied,1e3,vars.i18n.copy_affiliate_link,!0),app.initializeButtons(".affwp-tooltip-edit:not(.affwp-tooltip-initialized)","mouseenter focus",vars.i18n.edit_affiliate_link,0)},initializeButtons:function(className,trigger,content,hideDelay){var resetContent=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,manualTrigger=arguments.length>5&&void 0!==arguments[5]&&arguments[5],buttons=document.querySelectorAll(className);buttons.forEach(function(button){var instance=tippy(button,{trigger:trigger,duration:[300,250],hideOnClick:!1,onCreate:function(instance){instance.reference.classList.add("affwp-tooltip-initialized")}});button.addEventListener("click",function(){return app.handleButtonClick(instance,content,hideDelay,resetContent,manualTrigger)})})},handleButtonClick:function(instance,content,hideDelay){var resetContent=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,manualTrigger=arguments.length>4&&void 0!==arguments[4]&&arguments[4];instance.setContent(content),instance.show(),manualTrigger&&instance.setProps({trigger:"manual"}),setTimeout(function(){instance.hide(),manualTrigger&&instance.setProps({trigger:"mouseenter focus"})},hideDelay),resetContent&&instance.setProps({onHidden:function(){instance.setContent(resetContent),instance.setProps({onHidden:null})}})},cleanCampaignWhitespaces:function(){el.$campaign.val(el.$campaign.val().replace(/\s/g,""))},onCopy:function(event){event.preventDefault(),app.copyToClipboard($(this).closest("tr").data("custom-link-id"))},onEdit:function(event){event.preventDefault();var $row=$(this).closest("tr"),url=new URL($row.data("custom-link")),urlParams=new URLSearchParams(url.search),campaign=urlParams.get("campaign");el.$url.val($row.data("destination-link")).focus(),el.$form.find(".affwp-custom-link-id").val($row.data("custom-link-id")),el.$submitBtn.val(vars.i18n.custom_link_btn_update),app.hideCampaign(""),campaign&&app.showCampaign(campaign)},onSave:function(event){event.preventDefault(),app.queryCustomLink();var url=app.parseUrl(app.customLink.URL);return null===url?void app.showNotice(vars.i18n.invalid_url):void app.save(url.toString(),app.customLink.campaign,app.customLink.ID)},getTableRowHtml:function(fields){var tableRowHtml=vars.template;return Object.entries(fields).forEach(function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1];tableRowHtml=tableRowHtml.replace(new RegExp("{{\\b".concat(key,"\\b}}"),"g"),value)}),tableRowHtml},save:function(url){var campaign=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",customLinkId=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return"string"==typeof url&&app.isValidUrlString(url)?void $.ajax({type:"POST",url:vars.ajax_url,data:{action:"affwp_save_custom_link",nonce:vars.nonce,url:url,campaign:campaign,custom_link_id:customLinkId},dataType:"json",beforeSend:function(){app.lockForm(),app.showNotice(vars.i18n.saving,"success",0)},success:function(response){if(!response.success)return void app.showNotice(response.data.message);app.customLink.ID=response.data.fields.ID,el.$table.removeClass("affwp-hidden");var $tableRow=$(app.getTableRowHtml(response.data.fields));return response.data.updated?(el.$table.find('tbody tr[data-custom-link-id="'.concat(app.customLink.ID,'"]')).replaceWith($tableRow),setTimeout(function(){app.resetForm()},app.noticesTimeout)):(el.$table.find("tbody").prepend($tableRow),app.resetForm()),app.updateTooltips(),navigator&&navigator.clipboard?void navigator.clipboard.writeText($tableRow.data("custom-link")).then(function(){app.showNotice(response.data.updated?vars.i18n.successfully_updated_and_copied:vars.i18n.successfully_created_and_copied,"success")}).catch(function(){app.showNotice(response.data.message,"success")}):void app.showNotice(response.data.message,"success")},complete:function(response){response.responseJSON&&response.responseJSON.data&&response.responseJSON.data.updated||app.unlockForm()}}).fail(function(response){app.showNotice(vars.i18n.invalid_request)}):void console.error("Can not save. You must supply a valid url string.")},lockForm:function(){el.$campaign.attr("disabled",!0),el.$url.attr("disabled",!0),el.$submitBtn.attr("disabled",!0)},unlockForm:function(){el.$campaign.attr("disabled",!1),el.$url.attr("disabled",!1),el.$submitBtn.attr("disabled",!1)},resetForm:function(){el.$form.find(".affwp-custom-link-id").val(0),el.$submitBtn.val(vars.i18n.custom_link_btn_create),el.$url.val(""),app.unlockForm(),app.hideCampaign("")},queryCustomLink:function(){app.customLink={ID:parseInt(el.$form.find('input[type="hidden"].affwp-custom-link-id').val()),affiliateID:parseInt(el.$form.find('input[type="hidden"].affwp-affiliate-id').val()),URL:el.$url.val().toString(),campaign:el.$campaign.val().toString()}},copyToClipboard:function(customLinkID){var $row=el.$table.find('tbody tr[data-custom-link-id="'.concat(customLinkID,'"]'));if($row.length){var $copyBtn=$row.find(".affwp-copy-custom-link");$copyBtn.hasClass("copied")||navigator&&navigator.clipboard&&navigator.clipboard.writeText($row.data("custom-link"))}},showNotice:function(message){var timeout=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"error",arguments.length>2&&void 0!==arguments[2]?arguments[2]:null);timeout="number"==typeof timeout?parseInt(timeout):parseInt(app.noticesTimeout),app.notices.setContent(message),app.notices.show(),timeout>0&&setTimeout(function(){app.notices.hide()},timeout)},showCampaign:function(){var content=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;"string"==typeof content&&el.$campaign.val(content),el.$form.find(".affwp-generator-campaign-text-link-wrap").addClass("affwp-hidden"),el.$form.find(".affwp-campaign-wrap").removeClass("affwp-hidden")},hideCampaign:function(){var content=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;"string"==typeof content&&el.$campaign.val(content),el.$form.find(".affwp-campaign-wrap").addClass("affwp-hidden"),el.$form.find(".affwp-generator-campaign-text-link-wrap").removeClass("affwp-hidden")},onClickCampaignBtn:function(event){event.preventDefault(),app.showCampaign("")},isValidUrlString:function(url){return/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(url)},parseUrl:function(url){return"string"!=typeof url?(console.error("Url must be a string."),null):(url=url.trim().replace(/([^:])(\/\/+)/g,"$1/").replace(/ /g,"%20"),app.isValidUrlString(url)?new URL(url):null)}};return app}(jQuery),affWPCustomLink.init();