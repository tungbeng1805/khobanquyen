"use strict";function _typeof(o){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o})(o)}!function(){var affiliateWPCreatives={data:{},selectors:{creativesViewId:"affwp-creatives-view",modalPreviewId:"affwp-creatives-modal",modalContainerId:"affwp-modal-container",creativeListItem:".affwp-creatives-list-item.affwp-creatives-list-body",creativeClickableColumns:".affwp-creatives-item-actions",copyActionButton:'.affwp-creatives-list-action[data-action="copy"]',viewDetailsActionButton:'.affwp-creatives-list-action[data-action="view-details"]',modalItem:"[data-modal]",copyTextarea:".affwp-copy-textarea-content",creativeClone:".affwp-creative-clone",copyTooltip:'button[data-action="copy"]:not(.affwp-tooltip-initialized)',qrCodeActive:".fancybox__slide.is-selected .affwp-qrcode-modal-preview",qrCodePreview:".affwp-qrcode-preview",qrCodeModalPreview:".affwp-qrcode-modal-preview",qrCodeModalDownloadButton:".fancybox__slide.is-selected .affwp-button[data-download]"},eventHandlers:null,init:function(){this.data=affiliatewp.extend("affiliatewpCreativesData"),this.eventHandlers=new WeakMap,this.setupModals(),this.setupInfiniteScroll(),this.initActions(),this.generateQRCodes()},getCreativeIDFromHash:function(){var matches=window.location.hash.match(/^#creative-(\d+)$/);return matches?parseInt(matches[1]):0},setupModals:function(){var _this=this;if(!affiliatewp.has("modal"))throw new Error("Missing modal script. Ensure affiliatewp.modal is loaded correctly.");if(document.getElementById(this.selectors.creativesViewId)){var creativeID=this.getCreativeIDFromHash();creativeID&&document.querySelector('[data-slug="creative-'.concat(creativeID,'"]'))&&(creativeID=null),creativeID&&this.data.hasOwnProperty("creativeAjaxUrl")&&document.getElementById(this.selectors.creativesViewId).insertAdjacentHTML("afterbegin",'<span\n\t\t\t\t\t\t\tclass="'.concat(this.selectors.creativeClone.replace(".",""),'"\n\t\t\t\t\t\t\tdata-grouped\n\t\t\t\t\t\t\tdata-modal\n\t\t\t\t\t\t\tdata-type="ajax"\n\t\t\t\t\t\t\tdata-src="').concat(this.data.creativeAjaxUrl+creativeID,'"\n\t\t\t\t\t\t\tdata-slug="creative-').concat(creativeID,'"\n\t\t\t\t\t\t\tstyle="display: none"\n\t\t\t\t\t\t  ></span>')),affiliatewp.modal.onInit(function(){var clone=document.querySelector(_this.selectors.creativeClone);clone&&document.querySelector(".affwp-creative-clone").remove()}).onDone(function(){document.querySelectorAll(_this.selectors.qrCodeModalPreview).forEach(function(qrCodeElement){qrCodeElement instanceof Element&&!qrCodeElement.classList.contains("affwp-qrcode-initialized")&&affiliatewp.qrcode(qrCodeElement,qrCodeElement.dataset.url,affiliatewp.parseArgs(_this.parseQRCodeSettings(qrCodeElement),{format:"png"}))})}).onLoading(function(){_this.hideAllTooltips()}).bind(document.getElementById(this.selectors.creativesViewId),this.selectors.modalItem,{groupAll:!0,showThumbs:!1,dragToClose:!1,draggable:!1,autoFocus:!1,idle:!1,parentEl:document.getElementById(this.selectors.modalContainerId)})}},parseQRCodeSettings:function(qrCodeElement){if(!(qrCodeElement instanceof Element))throw new Error("Expected Element, got ".concat(_typeof(qrCodeElement)));return qrCodeElement.hasAttribute("data-settings")&&"object"===_typeof(JSON.parse(qrCodeElement.dataset.settings))?JSON.parse(qrCodeElement.dataset.settings):{}},setupInfiniteScroll:function(){var _this2=this;if(!affiliatewp.has("infiniteScroll"))throw new Error("Missing infiniteScroll script. Ensure affiliatewp.infiniteScroll is loaded correctly.");var elementToObserve=document.getElementById(this.selectors.creativesViewId);elementToObserve&&affiliatewp.infiniteScroll.setup(elementToObserve,this.data.hasOwnProperty("page")?this.data.page:1,this.data.hasOwnProperty("itemsPerPage")?this.data.itemsPerPage:30,{maxPages:this.data.hasOwnProperty("maxPages")?this.data.maxPages:-1,triggerElementHTML:'<div class="affwp-spinner"><svg viewBox="0 0 50 50"><circle cx="25" cy="25" r="20"></circle><circle cx="25" cy="25" r="20"></circle></svg></div>',ajax:{action:"affwp_creatives_load_more",nonce:this.data.hasOwnProperty("nonce")?this.data.nonce:"",data:this.data.hasOwnProperty("queryArgs")?affiliatewp.parseArgs(this.data.queryArgs):{}},on:{loadMore:function(){_this2.generateQRCodes(),_this2.makeClickableItems()}}})},isCopyEnabled:function(){return!(!navigator||!navigator.clipboard)},initActions:function(){var _this3=this;document.getElementById(this.selectors.modalContainerId).addEventListener("click",function(event){event.target&&!event.target.matches(_this3.selectors.copyTextarea)||(event.target.focus(),event.target.select())}),document.addEventListener("submit",function(event){event.target&&"affiliatewp_copy_form"!==event.target.name||(event.preventDefault(),_this3.handleCopyContent(event.target))}),document.addEventListener("click",function(event){if(event.target.classList.contains("affwp-download-button"))return event.preventDefault(),"qr_code"===event.target.dataset.type?void _this3.handleQRCodeDownload(event.target):void _this3.handleImageDownloadFromButton(event.target.dataset.download,event.target.dataset.href)}),document.addEventListener("click",function(event){if(event.target.classList.contains("affwp-print-button")){var sourceEl=document.querySelector(".fancybox__slide.is-selected .affwp-qrcode-modal-preview"),targetEl=document.getElementById("affwp-printable-area");if(targetEl)return targetEl.innerHTML=sourceEl.innerHTML,void window.print();targetEl=document.createElement("div"),targetEl.id="affwp-printable-area",targetEl.innerHTML=sourceEl.innerHTML,document.body.appendChild(targetEl),window.print()}}),this.makeClickableItems()},handleQRCodeDownload:function(clickedEl){var _this4=this,qrCodeElement=document.querySelector(this.selectors.qrCodeActive),qrCodeDownload=affiliatewp.qrcode();qrCodeDownload.updateSettings(qrCodeElement.hasAttribute("data-settings")&&"object"===_typeof(JSON.parse(qrCodeElement.dataset.settings))?JSON.parse(qrCodeElement.dataset.settings):{}),qrCodeDownload.createPNG(qrCodeElement.dataset.url,function(downloadUrl){_this4.handleImageDownloadFromButton(clickedEl.dataset.download,downloadUrl)})},handleImageDownloadFromButton:function(filename,downloadUrl){var downloadLink=document.createElement("a");downloadLink.download=filename,downloadLink.href=downloadUrl,downloadLink.target="_blank",downloadLink.click(),downloadLink.remove()},generateQRCodes:function(){if(!affiliatewp.has("qrcode"))throw new Error("Missing QR Code script. Ensure affiliatewp.qrcode is loaded correctly.");document.querySelectorAll(this.selectors.qrCodePreview).forEach(function(qrCodeElement){if(!qrCodeElement.classList.contains("affwp-qrcode-initialized")&&qrCodeElement.hasAttribute("data-url")){var qrCodeSettings=qrCodeElement.hasAttribute("data-settings")&&"object"===_typeof(JSON.parse(qrCodeElement.dataset.settings))?JSON.parse(qrCodeElement.dataset.settings):{};affiliatewp.qrcode(qrCodeElement,qrCodeElement.dataset.url,affiliatewp.parseArgs(qrCodeSettings,{format:"png"}))}})},makeClickableItems:function(){var _this5=this;document.querySelectorAll(this.selectors.creativeClickableColumns).forEach(function(col){if(!_this5.eventHandlers.has(col)){var boundEventHandler=_this5.handleItemClick.bind(_this5,col);_this5.eventHandlers.set(col,boundEventHandler),col.addEventListener("click",boundEventHandler)}})},handleItemClick:function(col){col.parentNode.querySelector(this.selectors.viewDetailsActionButton).click()},hideAllTooltips:function(){affiliatewp.tooltip.hideAll()},showCopyTooltip:function(content){var trigger=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"manual",placement=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"auto",hideDelay=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5e3;affiliatewp.tooltip.show(this.selectors.copyTooltip,content,{trigger:trigger,placement:placement,hideDelay:hideDelay})},handleCopyContent:function(el){var _this6=this,textarea=el.querySelector(this.selectors.copyTextarea);textarea.focus(),textarea.select(),this.isCopyEnabled()||this.showCopyTooltip(this.data.i18n.copyDisabled),this.copyContent(textarea.value,function(){return _this6.showCopyTooltip(_this6.data.i18n.copySuccess)},function(){return _this6.showCopyTooltip(_this6.data.i18n.copyError)})},copyContent:function(content,successCallback,errorCallback){return this.isCopyEnabled()?void navigator.clipboard.writeText(content).then(function(){successCallback&&"function"==typeof successCallback&&successCallback()}).catch(function(){errorCallback&&"function"==typeof errorCallback&&errorCallback()}):void console.error("Copy is disabled for an unknown reason.")}};affiliateWPCreatives.init()}();