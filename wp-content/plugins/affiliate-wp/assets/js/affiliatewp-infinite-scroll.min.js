"use strict";function _typeof(o){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o})(o)}affiliatewp.attach("infiniteScroll",{page:1,perPage:30,settings:{triggerElementHTML:"",triggerElementTag:"div",triggerElementClass:"affwp-infinite-scroll-trigger",triggerElementPosition:"afterend",provider:"ajax",maxPages:-1,ajax:{url:"/wp-admin/admin-ajax.php",action:"",nonce:"",data:{},method:"POST",headers:{},body:""},on:{beforeLoad:function(){},loadMore:function(){},finish:function(){}}},targetElement:null,triggerElement:null,states:["idle","loading","finished"],currentState:"idle",observer:null,setup:function(targetElement,page,perPage){var settings=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.setTargetElement(targetElement),this.setCurrentPage(page),this.setItemsPerPage(perPage),this.settings=affiliatewp.parseArgs(settings,this.settings),"ajax"===this.settings.provider&&""!==this.settings.ajax.action&&this.init()},setTargetElement:function(el){if(!(el instanceof Element))throw new Error('Target element expects to be an "Element" but got "'.concat(_typeof(el),'"'));this.targetElement=el},getTargetElement:function(){return this.targetElement},setCurrentPage:function(page){return"number"==typeof page&&page>0?(this.page=page,this):void console.error('Can not set "page". It must be a number greater than zero. Assuming default value.')},getCurrentPage:function(){return this.page},setItemsPerPage:function(perPage){return"number"==typeof perPage&&perPage>0?(this.perPage=perPage,this):void console.error('Can not set "perPage". It must be a number greater than zero. Assuming default value.')},getItemsPerPage:function(){return this.perPage},setTriggerElement:function(el){if(!(el instanceof Element))throw new Error('Trigger element expects to be an "Element" but got "'.concat(_typeof(el),'"'));this.triggerElement=el},getTriggerElement:function(){return this.triggerElement},setCurrentState:function(state){if(!this.states.includes(state))throw new Error('Can not set "state". You must use one of these options: '.concat(this.states.join(", ")));this.triggerElement instanceof Element&&(this.triggerElement.dataset.state=state),this.currentState=state},getCurrentState:function(){return this.currentState},callEvent:function(eventName){this.settings.on.hasOwnProperty(eventName)&&"function"==typeof this.settings.on[eventName]&&this.settings.on[eventName]()},init:function(){var _this=this;try{this.setupObserver(this.getTargetElement(),function(){if("number"==typeof _this.settings.maxPages&&Number.isInteger(_this.settings.maxPages)&&_this.settings.maxPages>-1&&_this.getCurrentPage()>=_this.settings.maxPages&&_this.setCurrentState("finished"),"finished"!==_this.getCurrentState()){if("ajax"!==_this.settings.provider)throw new Error('Unsupported provider. Expected "ajax" got "'.concat(_this.settings.provider,'"'));_this.callEvent("beforeLoad"),_this.setCurrentState("loading"),_this.disconnectObserver(),_this.setCurrentPage(_this.getCurrentPage()+1),_this.ajax().then(function(response){if("object"===_typeof(response))throw new Error("Ajax response must be a text but got JSON.");_this.handleHTMLResponse(response.toString()),_this.callEvent("loadMore")})}})}catch(error){console.error("AffiliateWPInfiniteScroll: ".concat(error))}},handleHTMLResponse:function(html){return html?(this.getTargetElement().insertAdjacentHTML("beforeend",html),this.setCurrentState("idle"),void this.reconnectObserver(1e3)):(this.setCurrentState("finished"),void this.callEvent("finish"))},useAjax:function(settings){this.settings.provider="ajax",this.settings.ajax=affiliatewp.parseArgs(settings,this.settings.ajax)},ajax:function(){var body=this.settings.ajax.body;return""===body&&(body=new FormData,body.append("action",this.settings.ajax.action),body.append("nonce",this.settings.ajax.nonce),body.append("page",this.getCurrentPage().toString()),body.append("items_per_page",this.getItemsPerPage().toString()),body.append("data",JSON.stringify(this.settings.ajax.data))),fetch(this.settings.ajax.url,{method:this.settings.ajax.method,headers:this.settings.ajax.headers,body:body}).then(function(response){if(!response.ok)throw new Error("Ajax request failed.");var contentType=response.headers.get("Content-Type");return contentType&&contentType.includes("application/json")?response.json():response.text()}).catch(function(error){console.error(error)})},disconnectObserver:function(){var _this2=this,timeout=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;!this.observer instanceof IntersectionObserver||setTimeout(function(){return _this2.observer.disconnect()},timeout)},reconnectObserver:function(){var _this3=this,delay=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;setTimeout(function(){return _this3.observer.observe(_this3.getTriggerElement())},delay)},setupObserver:function(elementToObserve,callback){var _this4=this;if(!window.IntersectionObserver)throw new Error("This browser do not support intersection observer.");if(!(elementToObserve instanceof Element))throw new Error('Target element expected and "Element" but found "'.concat(_typeof(elementToObserve),'"'));if("function"!=typeof callback)throw new Error('Callback expected a "function" was expected but found "'.concat(_typeof(callback),' instead"'));this.observer=new IntersectionObserver(function(entries){entries[0].isIntersecting&&callback(_this4.observer)});try{this.observer.observe(this.generateTriggerElement(elementToObserve))}catch(error){throw new Error("Infinite Scroll setup error: ".concat(error))}},generateTriggerElement:function(parentElement){if(!(parentElement instanceof Element))throw new Error('Element expected, got "'.concat(_typeof(parentElement),'"'));var triggerElement=document.createElement(""===this.settings.triggerElementTag?"div":this.settings.triggerElementTag);return triggerElement.classList.add(""===this.settings.triggerElementClass?"affwp-infinite-scroll-trigger":this.settings.triggerElementClass),triggerElement.dataset.state=this.getCurrentState(),""!==this.settings.triggerElementHTML&&triggerElement.insertAdjacentHTML("afterbegin",this.settings.triggerElementHTML),parentElement.insertAdjacentElement(["beforeend","afterend","beforebegin","afterbegin"].includes(this.settings.triggerElementPosition)?this.settings.triggerElementPosition:"beforeend",triggerElement),this.setTriggerElement(triggerElement),triggerElement}});