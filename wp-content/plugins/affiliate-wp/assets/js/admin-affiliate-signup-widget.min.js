"use strict";function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}document.addEventListener("DOMContentLoaded",function(){function setupWidget(widgetContainer){if(!widgetContainer.shadowRoot){var shadow=widgetContainer.attachShadow({mode:"open"});loadInitialWidget(shadow,widgetContainer)}}function loadInitialWidget(shadow,widgetContainer){fetch(affiliateWidgetParams.cssUrl).then(function(res){return res.text()}).then(function(css){var style=document.createElement("style");style.textContent=css,shadow.appendChild(style);var container=document.createElement("div");container.innerHTML=affiliateWidgetParams.widgetHtml,shadow.appendChild(container)}).then(function(){if(!widgetContainer.shadowReadyDispatched){var shadowReadyEvent=new CustomEvent("shadowReady",{detail:{shadow:shadow}});widgetContainer.dispatchEvent(shadowReadyEvent),widgetContainer.shadowReadyDispatched=!0}})}function widgetAttachFormSubmitEvent(shadow){var formInsideShadow=shadow.querySelector("form");formInsideShadow&&formInsideShadow.addEventListener("submit",function(e){e.preventDefault();var buttonElement=shadow.querySelector("#signup-affiliate-preview");buttonElement&&simulateAffiliateSignup(buttonElement,shadow)})}function simulateAffiliateSignup(buttonElement,shadow){buttonLoadingState(buttonElement),setTimeout(function(){showConfirmation(mockResponse,shadow,!0),viewToggle.checked=!0},1e3)}function buttonLoadingState(buttonElement){var svgSpinner=buttonElement.querySelector("svg"),originalButtonText=buttonElement.querySelector("#originalButtonText"),processingText=buttonElement.querySelector("#processingText");svgSpinner&&svgSpinner.removeAttribute("hidden"),processingText&&processingText.removeAttribute("hidden"),originalButtonText&&originalButtonText.setAttribute("hidden",!0),buttonElement.disabled=!0,buttonElement.classList.add("cursor-not-allowed")}function showConfirmation(response,shadow,shouldShow){var initialView=shadow.querySelector("#initial-view"),confirmationView=shadow.querySelector("#confirmation-view"),button=shadow.querySelector("#signup-affiliate-preview");shouldShow?response&&response.data&&response.data.affiliate_link&&(confirmationView.innerHTML=confirmationView.innerHTML.replace("{affiliateLink}",response.data.affiliate_link),confirmationView.style.display="block",initialView.style.display="none"):(confirmationView.style.display="none",initialView.style.display="block",resetButtonState(button)),attachCopyLinkButtonEventListener(shadow)}function resetButtonState(button){var svgSpinner=button.querySelector("svg"),originalButtonText=button.querySelector("#originalButtonText"),processingText=button.querySelector("#processingText");svgSpinner&&svgSpinner.setAttribute("hidden",!0),processingText&&processingText.setAttribute("hidden",!0),originalButtonText&&originalButtonText.removeAttribute("hidden"),button.disabled=!1,button.classList.remove("cursor-not-allowed")}function attachCopyLinkButtonEventListener(shadow){function copyAffiliateLink(){var affiliateLinkInput=shadow.querySelector("#affiliateLink");if(affiliateLinkInput){var affiliateLink=affiliateLinkInput.value;navigator.clipboard.writeText(affiliateLink).then(function(){affiliateLinkInput.select()}).catch(function(error){console.error("Copy failed",error)})}}var copyLinkButton=shadow.querySelector("#copyLinkButton");copyLinkButton&&copyLinkButton.addEventListener("click",function(){copyAffiliateLink();var originalText=copyLinkButton.textContent;copyLinkButton.textContent=affiliateWidgetParams.data.button_copied_text,setTimeout(function(){copyLinkButton.textContent=originalText},3e3)})}function generateShades(brandColor,shadow){for(var brandColorRGB=brandColor.slice(1),r=parseInt(brandColorRGB.slice(0,2),16)/255,g=parseInt(brandColorRGB.slice(2,4),16)/255,b=parseInt(brandColorRGB.slice(4,6),16)/255,luminance=.2126*r+.7152*g+.0722*b,isDark=luminance<.6,shades=isDark?{100:"color-mix(in srgb, ".concat(brandColor," 15%, white 85%)"),105:"color-mix(in srgb, ".concat(brandColor," 15%, white 85%)"),110:"color-mix(in srgb, ".concat(brandColor," 60%, white 40%)"),115:"color-mix(in srgb, ".concat(brandColor," 70%, white 30%)"),120:"color-mix(in srgb, ".concat(brandColor," 10%, white 90%)"),125:"color-mix(in srgb, ".concat(brandColor," 10%, white 90%)"),130:"color-mix(in srgb, ".concat(brandColor," 10%, white 90%)"),200:"color-mix(in srgb, ".concat(brandColor," 15%, white 85%)"),205:"color-mix(in srgb, ".concat(brandColor," 15%, white 85%)"),210:"color-mix(in srgb, ".concat(brandColor," 10%, white 90%)"),215:"color-mix(in srgb, ".concat(brandColor," 10%, white 90%)"),220:"color-mix(in srgb, ".concat(brandColor," 30%, black 70%)"),225:"color-mix(in srgb, ".concat(brandColor," 10%, white 90%)"),230:"color-mix(in srgb, ".concat(brandColor," 70%, black 30%)"),235:"color-mix(in srgb, ".concat(brandColor," 90%, black 10%)"),240:"color-mix(in srgb, ".concat(brandColor," 10%, white 90%)"),300:"color-mix(in srgb, ".concat(brandColor," 10%, white 90%)"),305:"color-mix(in srgb, ".concat(brandColor," 10%, white 90%)"),500:brandColor}:{100:"color-mix(in srgb, ".concat(brandColor," 30%, black 70%)"),105:"color-mix(in srgb, ".concat(brandColor," 30%, black 70%)"),110:"color-mix(in srgb, ".concat(brandColor," 30%, black 70%)"),115:"color-mix(in srgb, ".concat(brandColor," 30%, black 70%)"),120:"color-mix(in srgb, ".concat(brandColor," 10%, white 90%)"),125:"color-mix(in srgb, ".concat(brandColor," 30%, black 70%)"),130:"color-mix(in srgb, ".concat(brandColor," 30%, black 70%)"),200:"color-mix(in srgb, ".concat(brandColor," 30%, black 70%)"),205:"color-mix(in srgb, ".concat(brandColor," 30%, black 70%)"),210:"color-mix(in srgb, ".concat(brandColor," 10%, white 90%)"),215:"color-mix(in srgb, ".concat(brandColor," 10%, white 90%)"),216:"color-mix(in srgb, ".concat(brandColor," 80%, black 20%)"),220:"color-mix(in srgb, ".concat(brandColor," 30%, black 70%)"),225:"color-mix(in srgb, ".concat(brandColor," 10%, white 90%)"),230:"color-mix(in srgb, ".concat(brandColor," 20%, black 80%)"),235:"color-mix(in srgb, ".concat(brandColor," 30%, black 70%)"),240:"color-mix(in srgb, ".concat(brandColor," 10%, white 90%)"),300:"color-mix(in srgb, ".concat(brandColor," 30%, black 70%)"),305:"color-mix(in srgb, ".concat(brandColor," 30%, black 70%)"),500:brandColor},cssVariables=":host { ",_i=0,_Object$entries=Object.entries(shades);_i<_Object$entries.length;_i++){var _Object$entries$_i=_slicedToArray(_Object$entries[_i],2),key=_Object$entries$_i[0],value=_Object$entries$_i[1];cssVariables+="--brand-".concat(key,": ").concat(value,"; ")}cssVariables+="}";var styleElement=shadow.getElementById("brand-colors");styleElement||(styleElement=document.createElement("style"),styleElement.id="brand-colors",shadow.appendChild(styleElement)),styleElement.textContent=cssVariables}function attachLivePreview(inputSelector,shadowSelector,propertyToUpdate){var isStyle=arguments.length>3&&void 0!==arguments[3]&&arguments[3],isConfirmationRelated=arguments.length>4&&void 0!==arguments[4]&&arguments[4],shadow=arguments.length>5?arguments[5]:void 0,inputElement=document.getElementById(inputSelector);if(inputElement){var inputHandler=function(e){var newValue=e.target.value,formattedValue=isStyle?newValue:newValue.replace(/\n/g,"<br>"),targetElement=isConfirmationView?shadow.querySelector("#confirmation-view "+shadowSelector):shadow.querySelector(shadowSelector);targetElement&&(isStyle?targetElement.style[propertyToUpdate]=formattedValue:targetElement.innerHTML=formattedValue)};inputElement._inputHandler&&inputElement.removeEventListener("input",inputElement._inputHandler),inputElement.addEventListener("input",inputHandler),inputElement._inputHandler=inputHandler;var focusHandler=function(){isConfirmationRelated?switchToConfirmationView(shadow):resetToInitialView(shadow)};inputElement._focusHandler&&inputElement.removeEventListener("focus",inputElement._focusHandler),inputElement.addEventListener("focus",focusHandler),inputElement._focusHandler=focusHandler}}function resetToInitialView(shadow){viewToggle.checked=!1,isConfirmationView=!1,showConfirmation(mockResponse,shadow,!1)}function switchToConfirmationView(shadow){viewToggle.checked=!0,isConfirmationView=!0,showConfirmation(mockResponse,shadow,!0)}function handleShadowReady(shadow,widgetContainer){function updateImagePreview(imageUrl,shadow){var imageContainer,imageWrapper=shadow.querySelector("#signup-image");if(imageWrapper)imageContainer=imageWrapper.querySelector("div");else{imageContainer=document.createElement("div"),imageContainer.id="signup-image",imageContainer.className="absolute inset-0 opacity-25",imageContainer.setAttribute("aria-hidden","true");var aspectRatioBox=document.createElement("div");aspectRatioBox.className="absolute inset-0 overflow-hidden",aspectRatioBox.setAttribute("aria-hidden","true"),imageContainer.appendChild(aspectRatioBox);var widgetContent=shadow.querySelector("#widget-content");widgetContent.insertAdjacentElement("beforebegin",imageContainer)}var imageElement=imageContainer.querySelector("img");imageElement||(imageElement=document.createElement("img"),imageElement.alt="",imageElement.className="h-full w-full object-cover object-center",imageContainer.appendChild(imageElement)),imageElement.src=imageUrl}shadow&&(widgetAttachFormSubmitEvent(shadow),attachLivePreview("affwp_settings[affiliate_signup_widget_heading_text]","h1","textContent",!1,!1,shadow),attachLivePreview("affwp_settings[affiliate_signup_widget_text]","p","textContent",!1,!1,shadow),attachLivePreview("affwp_settings[affiliate_signup_widget_button_color]","button","backgroundColor",!0,!1,shadow),attachLivePreview("affwp_settings[affiliate_signup_widget_button_text]","button","textContent",!1,!1,shadow),attachLivePreview("affwp_settings[affiliate_signup_widget_confirmation_heading_text]","h1","textContent",!1,!0,shadow),attachLivePreview("affwp_settings[affiliate_signup_widget_confirmation_text]","p","textContent",!1,!0,shadow),document.addEventListener("mediaURLChanged",function(event){var newUrl=event.detail.url;updateImagePreview(newUrl,shadow)}))}var isConfirmationView=!1,mockResponse={data:{affiliate_link:affiliateWidgetParams.affiliateLinkPreview}},widgetContainers=document.querySelectorAll(".affiliate-signup");widgetContainers.forEach(function(widgetContainer){widgetContainer.shadowReadyDispatched=!1,setupWidget(widgetContainer)});var viewToggle=document.getElementById("viewToggle");viewToggle.addEventListener("change",function(){isConfirmationView=viewToggle.checked,widgetContainers.forEach(function(widgetContainer){var shadow=widgetContainer.shadowRoot;shadow&&showConfirmation(mockResponse,shadow,isConfirmationView)})});var colorInput=document.getElementById("affwp_settings[affiliate_signup_widget_brand_color]");colorInput.addEventListener("input",function(event){var colorValue=event.target.value;widgetContainers.forEach(function(widgetContainer){var shadow=widgetContainer.shadowRoot;shadow&&generateShades(colorValue,shadow)})});var resetLink=document.querySelector(".affwp-reset-color-link");resetLink.addEventListener("click",function(event){event.preventDefault(),widgetContainers.forEach(function(widgetContainer){var shadow=widgetContainer.shadowRoot;if(shadow){var defaultColor="#4b64e2";colorInput.value=defaultColor,generateShades(defaultColor,shadow)}})}),widgetContainers.forEach(function(widgetContainer){widgetContainer.shadowReadyDispatched?handleShadowReady(widgetContainer.shadowRoot,widgetContainer):widgetContainer.addEventListener("shadowReady",function(event){widgetContainer.shadowReadyDispatched||(widgetContainer.shadowReadyDispatched=!0,handleShadowReady(event.detail.shadow,widgetContainer))})})});