"use strict";(function(document,window,$){var el={},app={init:function(){$(app.ready)},ready:function(){app.initVars(),app.events()},initVars:function(){el={$stepInstall:$("section.step-install"),$stepInstallNum:$("section.step-install .num img"),$stepSetup:$("section.step-setup"),$stepSetupNum:$("section.step-setup .num img"),$stepAddon:$("section.step-addon"),$stepAddonNum:$("section.step-addon .num img")}},events:function(){el.$stepInstall.on("click","button",app.stepInstallClick),el.$stepSetup.on("click","button",app.gotoURL),el.$stepAddon.on("click","button",app.gotoURL)},stepInstallClick:function(){var $btn=$(this),action=$btn.attr("data-action"),plugin=$btn.attr("data-plugin"),ajaxAction="";if(!$btn.hasClass("disabled")){switch(action){case"activate":ajaxAction="affwp_activate_plugin",$btn.text(affiliate_wp_analytics.activating);break;case"install":ajaxAction="affwp_install_plugin",$btn.text(affiliate_wp_analytics.installing);break;case"goto-url":return void(window.location.href=$btn.attr("data-url"));default:return}$btn.addClass("disabled"),app.showSpinner(el.$stepInstallNum),$.post(affiliate_wp_analytics.ajax_url,{action:ajaxAction,nonce:affiliate_wp_analytics.nonce,plugin:plugin}).done(function(res){app.stepInstallDone(res,$btn,action)}).always(function(){app.hideSpinner(el.$stepInstallNum)})}},stepInstallDone:function(res,$btn,action){if("install"===action?res.success&&res.data.is_activated:res.success)return el.$stepInstallNum.attr("src",el.$stepInstallNum.attr("src").replace("step-1.","step-complete.")),$btn.addClass("grey").removeClass("button-primary").text(affiliate_wp_analytics.activated),void app.stepInstallPluginStatus();var activationFail="install"===action&&res.success&&!res.data.is_activated||"activate"===action,url=activationFail?affiliate_wp_analytics.mi_manual_activate_url:affiliate_wp_analytics.mi_manual_install_url,msg=activationFail?affiliate_wp_analytics.error_could_not_activate:affiliate_wp_analytics.error_could_not_install,btn=activationFail?affiliate_wp_analytics.plugins_page:affiliate_wp_analytics.download_now;$btn.removeClass("grey disabled").text(btn).attr("data-action","goto-url").attr("data-url",url).after('<p class="error">'+msg+"</p>")},stepInstallPluginStatus:function(){$.post(affiliate_wp_analytics.ajax_url,{action:"affwp_analytics_page_check_plugin_status",nonce:affiliate_wp_analytics.nonce}).done(app.stepInstallPluginStatusDone)},stepInstallPluginStatusDone:function(res){if(res.success)return el.$stepSetup.removeClass("grey"),el.$stepSetupBtn=el.$stepSetup.find("button"),res.data.setup_status>0?(el.$stepSetupNum.attr("src",el.$stepSetupNum.attr("src").replace("step-2.svg","step-complete.svg")),el.$stepAddon.removeClass("grey").find("button").attr("data-url",res.data.step3_button_url).removeClass("grey disabled").addClass("button-primary"),void("pro"===res.data.license_level&&el.$stepAddon.find("button").text(res.data.addon_installed>0?affiliate_wp_analytics.activate_now:affiliate_wp_analytics.install_now))):void el.$stepSetupBtn.removeClass("grey disabled").addClass("button-primary")},gotoURL:function(){var $btn=$(this);$btn.hasClass("disabled")||(window.location.href=$btn.attr("data-url"))},showSpinner:function($el){$el.siblings(".loader").removeClass("hidden")},hideSpinner:function($el){$el.siblings(".loader").addClass("hidden")}};return app})(document,window,jQuery).init();